<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Racing Puzzle Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Main container -->
    <div id="game-container"></div>

    <!-- Scripts -->
    <script type="module">
        import Puzzle from './scripts/puzzle.js';
        import RacerGame from './scripts/RacerGame.js';
        import TouchControls from './scripts/TouchControls.js';
        import UIManager from './scripts/UIManager.js';

        // Load assets (placeholders, replace with actual images)
        const assets = {};
        const assetPaths = {
            car: 'assets/car.png',
            enemy: 'assets/enemy.png',
            road: 'assets/road.png',
            start: 'assets/start.png',
            finish: 'assets/finish.png',
            flame: 'assets/flame.png',
            coin: 'assets/coin.png',
            nitro: 'assets/nitro.png',
            health: 'assets/health.png',
            joystick: 'assets/joystick.png',
        };

        const loadAssets = async () => {
            const promises = [];
            for (const key in assetPaths) {
                const img = new Image();
                img.src = assetPaths[key];
                assets[key] = img;
                promises.push(new Promise(res => img.onload = res));
            }
            await Promise.all(promises);
        };

        const startGame = async () => {
            await loadAssets();

            // Step 1: Puzzle
            const puzzleCanvas = document.createElement('canvas');
            document.getElementById('game-container').appendChild(puzzleCanvas);

            const puzzle = new Puzzle({
                canvas: puzzleCanvas,
                rows: 7,
                cols: 7,
                tileSize: 64,
                timeLimitSec: 45,
                progressTarget: 6
            }, () => {
                // Puzzle complete â†’ start country selection or race
                puzzle.destroy();

                // Step 2: Racing game container
                const gameContainer = document.getElementById('game-container');
                gameContainer.innerHTML = ''; // clear
                const canvas = document.createElement('canvas');
                gameContainer.appendChild(canvas);

                // Initialize RacerGame
                const game = new RacerGame({
                    canvas,
                    assets
                });

                // Touch / keyboard controls
                const controls = new TouchControls(canvas);
                game.setControls(controls);

                // UI
                const ui = new UIManager(game);
                ui.init();

                game.start();
            });
        };

        startGame();
    </script>
</body>
</html>
